---
title: 'Authorization Flow'
description: 'Allow your users to connect their SID account to your application'
---
## Overview
The OAuth2.0 authentication flow is a standard protocol for allowing users to connect their accounts from one application to another.
SID uses this protocol to securely give your application access to the user's SID account.
It involves the following steps:

1. **Authorization Link:** 
In your application, the user clicks a special authorization link which takes them to the SID dashboard to authenticate.

2. **Redirect:** 
After the user logs in and grants access permissions to your application, SID redirects them back to your application with an authorization code. 
They are redirected to a previously specified URI, such as `https://foo.com/api/sid/callback`. 
This URI is specific to your application, and you can choose it yourself.

3. **Tokens Issued:** 
Your application makes a POST request to SID's token endpoint with the authorization code,
client ID, and client secret, and receives an access token and refresh token in response.

Once you have the access token, you can use it to make requests to the SID API on behalf of the user.

## Client Credentials
Before you can initiate the authorization flow, you must register your application with SID to receive your [client credentials](/auth/credentials).
These credentials are used to identify your application when performing the authorization flow.

You will receive these credentials during our onboarding process. 
In the future, you will be able to register your application through the SID developer dashboard.

## Initiate Flow
The authorization flow is initiated by redirecting a user to the SID authorization URL, shown below:
```bash
https://me.sid.ai/api/oauth/authorize
```
To initiate the flow, you must set up the following query parameters in the URL:
```python
params = {
    'response_type': 'code',
    'scope': 'query:data offline_access',
    'client_id': env.SID_CLIENT_ID,
    'redirect_uri': env.SID_REDIRECT_URI,
    'state': gen_random_state(), # optional
}
auth_url = 'https://me.sid.ai/api/oauth/authorize'
auth_url += '?' + urlencode(params)

# now, redirect user to auth_url
``` 
As an example, the following might be a valid authorization URL:
```bash
https://me.sid.ai/api/oauth/authorize?response_type=code&scope=query%3Adata+offline_access&client_id=my_client_id&redirect_uri=https%3A%2F%2Fexample.com%2Fcallback&state=abcde
```

You then need to redirect the user to this URL. 
Usually, this will happen through a button or link in your application, 
which could be located in a settings page, or on the user's profile page.

<Info>
The `state` parameter is a random string that you generate. 
It is then returned to your application in the callback, and you can use it to verify that the callback is legitimate.
Passing a `state` is optional, but recommended.
</Info>

## Callback
The authorization URL will redirect the user to the SID dashboard, where they will be prompted to log in and grant access permissions to your application.
Once they have done so, they will be redirected back to your application with an authorization code. You will need to provide a callback URL to receive this code.

For example, if your application is hosted at `https://foo.com`, you could specify a callback URL of `https://foo.com/api/sid/callback`. 
You should then handle incoming `GET` requests to this URL to receive the authorization code.
Continuing with the example, a possible callback would be a `GET` request to `https://foo.com/api/sid/callback?code=mycoolcode`.
The following code snippet shows example callback handlers in a few different languages and frameworks.

<CodeGroup>

```typescript Next.js
import { NextApiRequest, NextApiResponse } from 'next';

export default async function handler(req: NextApiRequest, res: NextApiResponse) {
  // extract state value from query string
  let state = req.query.state;
  // verify that state value corresponds to a previously issued state
  if (!check_state(state)) {
    res.status(400).send('Invalid state');
    return;
  }
  // get authorization code from query string
  let code = req.query.code;
  // perform token exchange to get access token and refresh token
  let { accessToken, refreshToken } = await tokenExchange(code);
  // save refresh token to database and update user's authentication state
  // ...
```

```typescript Next.js (app router)
export async function GET(request: Request) {
  if (!check_state(request.query.get('state'))) {
    return {
      status: 400,
      body: 'Invalid state',
    };
  }
  // get authorization code from query string
  let code = request.query.get('code');
  // perform token exchange to get access token and refresh token
  let { accessToken, refreshToken } = await tokenExchange(code);
  // save refresh token to database and update user's authentication state
  // ...
}
```

```python Python (FastAPI)
app = FastAPI()

@app.get("/sid/callback")
async def read_root(request: Request):
    # extract state value from query string
    state = request.query_params.get('state')
    # verify that state value corresponds to a previously issued state
    if not check_state(state):
        return Response(status_code=400, content='Invalid state')
    code = request.query_params.get('code')
    # perform token exchange to get access token and refresh token
    accessToken, refreshToken = await token_exchange(code)
    # save refresh token to database and update user's authentication state
    # ...

```
</CodeGroup>

Of course, you can implement this in any language or framework you like.

## Token Exchange
Once you have the authorization code, you can exchange it for an access token and refresh token.
You can do this with a simple `POST` request to the SID token endpoint, with the authorization code, client ID, and client secret.
The below code snippet shows an example of how to do this in Node.js using the [axios](https://www.npmjs.com/package/axios) library.

<CodeGroup>
```typescript Node.js
import axios from 'axios';

async function tokenExchange(code: string) {
// construct data to send to SID
  const data = {
    grant_type: 'authorization_code',
    client_id: process.env.SID_CLIENT_ID,
    client_secret: process.env.SID_CLIENT_SECRET,
    redirect_uri: process.env.SID_REDIRECT_URI,
    code: code,
  };

  // send request to SID token endpoint
  const response = await axios.post('https://auth.sid.ai/oauth/token', data);

  // extract tokens from response
  const {
    access_token, 
    refresh_token, 
    scope, 
    expires_in,
    token_type, 
  } = response.data;

  // return tokens
  return {
    refreshToken: refresh_token,
    accessToken: access_token,
  }
}
```
```python Python
import os
import httpx

async def token_exchange(code: str):
    # construct data to send to SID
    data = {
        'grant_type': 'authorization_code',
        'client_id': os.environ.get('SID_CLIENT_ID'),
        'client_secret': os.environ.get('SID_CLIENT_SECRET'),
        'redirect_uri': os.environ.get('SID_REDIRECT_URI'),
        'code': code,
    }

    # send request to SID token endpoint
    async with httpx.AsyncClient() as client:
        response = await client.post('https://auth.sid.ai/oauth/token', data=data)

    # extract tokens from response
    access_token = response.json().get('access_token')
    refresh_token = response.json().get('refresh_token')

    return {
        'refresh_token': refresh_token,
        'access_token': access_token,
    }
```
</CodeGroup>

Once you have the access token, you can use it to make requests to the SID API on behalf of the user.

<Info>
The access token is valid for 24 hours. After this time, you will need to [use the refresh token](/auth/tokens) to get a new access token.
</Info>

## Using the Refresh Token

<CardGroup cols={2}>
  <Card
    title="Access the API"
    icon="rocket"
    href="/build/query"
  >
    Use the access token to make your first request to the SID API
  </Card>
  <Card
    title="Token Types"
    icon="key"
    href="/auth/tokens"
  >
    Learn more about the different tokens and how to handle them correctly
  </Card>
</CardGroup>
